# CHCANet

Gang Wang, Yufei Chen, Bin Wu,
CHCANet: Two-view Correspondence Pruning with Consensus-guided Hierarchical Context Aggregation,
Pattern Recognition,（IF=7.6）

## HCA

### **核心目标**

解决现有方法（如OANet）的局限性：**未能充分利用多粒度层次特征**。传统OA模块（图1a）仅通过单一聚类视图处理特征，而HCA框架（图1b）通过**多级聚类**捕获局部与全局上下文，生成更具判别力的特征表示。

### **技术框架详解**

#### **1. 整体流程（图4）**

- **输入**：图节点特征$F={{f_i}}_{i=1}^N∈R^{N×D}$（对应点特征）。
- **多级聚类**：通过`DiffPool`生成不同粒度的聚类视图（如c1=0.5N,c2=0.25N*c*1=0.5*N*,*c*2=0.25*N*）。
- **特征提取**：每个聚类视图经`OA Block`过滤，捕获全局上下文。
- **特征重建**：通过`DiffUnPool`上采样并拼接多级特征，融合局部与全局信息。
- **输出**：精炼块（ℜ(⋅)ℜ(⋅)）整合特征，输出Fout∈RN×DF*o**u**t*∈R*N*×*D*。

#### **2. 关键公式解析**

- **聚类分配矩阵**（式2）：

  $Spi=\sigma(P(F)),F_{down}^{(c_i)}=S_{pi}^TF$

  - P(⋅)P(⋅)：基于Context Normalization（CN）的置换等变函数（图5），生成软分配矩阵Spi∈RN×ciS*p**i*∈R*N*×*c**i*。
  - σ(⋅)*σ*(⋅)：Softmax归一化每行，确保节点分配到各聚类的概率和为1。
  - Fdown(ci)F*d**o**w**n*(*c**i*)：降维后的聚类特征（维度从N×D*N*×*D*降至N×ci*N*×*c**i*）。

- **特征重建**（式4-5）：

  $F_{up}^{(c)}=S_{u_j}O(F_{down}^{(c)}),F_{up}=[Fup^{(c_i)}∥⋯∥F_{up}^{(c_m)}]]$

  - O(⋅)：OA过滤块（图6），从低维聚类中提取全局上下文。
  - ∥：特征拼接操作，融合多粒度信息（维度升至RN×mDR*N*×*m**D*)。
  - 精炼块ℜ(⋅)将特征压缩回$R^{N×D}$，保持顺序一致性。

| **组件**   | **OANet**                     | **HCA框架**                                   |
| :--------- | :---------------------------- | :-------------------------------------------- |
| 聚类视图   | 单一固定聚类（如c=500*c*=500) | 多级动态聚类（如[0.5N,0.25N][0.5*N*,0.25*N*]) |
| 架构       | 浅层U型结构                   | 多头（Multi-head）架构                        |
| 特征利用   | 忽略中间层信息                | 显式聚合多粒度特征金字塔                      |
| 上下文融合 | 局部+全局简单融合             | 共识引导的层次化聚合                          |

### **创新点总结**

1. **多粒度聚类**：
   通过多级降维比（如[0.5,0.25,0.125][0.5,0.25,0.125]）生成特征金字塔，模拟人眼从粗到细的感知过程。
2. **并行化处理**：
   各聚类视图独立处理再拼接，避免串行结构的信息损失。
3. **层次特征重建**：
   `DiffUnPool`恢复原始结构时，保留各聚类视图的独特上下文信息。
4. **轻量化设计**：
   相比堆叠多个OA模块（表11显示3个OA块最优），HCA以更低计算成本提升性能（表9）。

## Consensus Guidance Block

### **设计动机**

- **问题**：HCA框架的多聚类视图虽能捕获全局上下文，但**输入特征缺乏空间结构强调**（原文："input features are not sufficiently highlighted or structured"）。
- **关键观察**：真实匹配点具有**局部运动一致性**（图2），而离群点空间分布混乱。
- **解决方案**：引入共识引导块（Consensus Block），利用动态图CNN强化局部几何约束，使HCA的输入特征对齐空间结构。

------

### **技术实现详解**

#### **1. 局部共识建模流程（图7）**

- **步骤1**：构建KNN图 ρi(vi,ϵi)

  - $vi={C^i_1,…,C_i^k}$:特征空间中第i个对应点的k近邻（k=9）。
  - ϵi*ϵ**i*：从中心点到邻居的有向边。

- **步骤2**：动态图CNN特征提取（式7）：

  $Fcn=M(Fin),F_{cn}′=[F_{cn}^{×k}||F_{residual}]$

  - M(⋅)：基于Context Normalization的嵌入层。
  - $F_{residual}=F_{cn}^{×k}−F_{knn}$：残差特征（刻画局部运动一致性）。

- **步骤3**：环形卷积（Annular Convolution）：

  - 使用1×31×3和1×1核组合，替代传统MLP的1×11×1核。
  - 解决MLP**忽略图结构**的问题，显式捕获邻域拓扑关系。
  - 输出：降维后的共识特征 $F'_{ac}∈R^{N×D}$

- **步骤4**：残差连接（式8）：

  $F_{consensus}=F_{in}+F′_{ac}$

  - 保留原始特征的同时注入局部共识信息。

  | **技术**         | **传统方法**    | **共识引导块改进**          | **优势**                 |
  | :--------------- | :-------------- | :-------------------------- | :----------------------- |
  | **邻域特征构建** | 静态坐标差值    | 特征空间残差 $F_{residual}$ | 融合几何与语义一致性     |
  | **结构感知卷积** | MLP（1×11×1核） | 环形卷积（1×3+1×11×3+1×1）  | 显式建模邻域序列关系     |
  | **特征融合**     | 简单拼接/相加   | 残差连接 + 特征拼接         | 避免信息淹没，强化一致性 |

## 实验

### 相对姿态估计

![](image\CHCANet_pose_estimation.png)

### 消融

![xiaorong](image\CHCANet_fusion.png)



## 总结

- 感觉代码的改动挺小的